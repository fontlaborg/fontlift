# Changelog

## Unreleased
- build.sh now bootstraps a `.venv` (prefers `uv venv`, falls back to `python -m venv`) before running `maturin develop`, so Python binding builds succeed without a pre-activated virtualenv.
- Made `fontlift-python` bindings opt-in via a `python-bindings` feature so default workspace builds no longer require a host Python toolchain; `pyproject.toml` and build scripts enable the feature for maturin wheel builds.
- Switched Python packaging to the `maturin` build backend with an explicit crate manifest path to silence pep517 build warnings and align pip builds with the Rust extension.
- Fixed Windows registry value matching helper gating so `fontlift-platform-win` tests compile on non-Windows hosts, keeping cross-platform test runs green.
- Windows manager now supports optional out-of-process validation (matching macOS) via `WinFontManager::with_validation` and Python `strict=True`, rejecting malformed fonts before registry/GDI changes.
- Windows install/remove operations are now journaled (CopyFile/RegisterFont and UnregisterFont/DeleteFile) to participate in `fontlift doctor` crash recovery.
- Windows registry pruning/unregister now normalizes filename-only entries and matches case-insensitively, preventing stale registry values when fonts live under Fonts roots.
- Python Fire CLI now mirrors the Rust surface (JSON list rendering, quiet/verbose/dry-run status messaging) and `list_fonts` returns dictionaries; added pure-Python list rendering helpers with tests.
- Added Atkinson Hyperlegible OTF/TTC fixtures plus Windows metadata tests to cover TTC collections alongside TTF parsing.
- Added README packaging notes covering build.sh outputs, Windows prerequisites, and maturin wheel builds.
- Added `RELEASE_CHECKLIST.md` with Rust crates + PyPI + GitHub release steps and refreshed the feature matrix to reflect current CLI parity and Windows validation gaps.
- Added GitHub Actions CI matrix (macOS 14, Windows) running rustfmt/clippy, platform-scoped cargo tests, and `maturin develop` + `pytest` for the Python bindings.
- Updated README/USAGE/FEATURE_MATRIX with current macOS parity, Windows validation status, and Python cleanup toggles.
- Added macOS fake-registry integration tests that round-trip install/list/uninstall through the CLI handlers and assert deterministic JSON output; Python bindings now ship a pytest harness that skips cleanly unless the extension is built via `maturin develop`.
- Python cdylib now builds as `_native` to match the `fontlift._native` module, eliminating the PyInit symbol warning; bindings now use `into_pyobject` instead of deprecated `into_py`, and README Python examples import `fontlift`.
- build.sh now runs maturin against the `crates/fontlift-python` manifest so Python binding builds no longer fail with a workspace `missing field package` error.
- Core now exposes conflict detection (path/PostScript/family+style) and Windows installs auto-unregister/remove duplicate registry/file entries before copying, while refusing to overwrite protected system font paths.
- Windows cleanup now also purges Adobe font cache manifests (`AdobeFnt*.lst`) under common Program Files Adobe TypeSupport/TypeSpt/PDFL roots to mirror legacy cache clearing.
- Windows cleanup now prunes missing registry font entries and clears the FontCache service (stop → delete cache files/FNTCACHE.DAT → start), improving parity with the legacy C++ CLI; user-scope cleanup now explicitly requires `--admin` on Windows.
- CLI cleanup now downgrades user-scope cache-clear `PermissionDenied` responses to warnings so `fontlift cleanup` succeeds without `--admin` while system-scope cache clears still fail without elevation; added a CLI unit test to lock behavior.
- macOS installs now copy fonts into the target scope directory and auto-resolve Core Text "already registered"/duplicate-name errors by unregistering and retrying the registration path; reinstalling in fake/user scopes replaces the installed file to keep upgrades deterministic.
- `is_font_installed` now checks both the scope target path and Core Text registered URLs, and fake-registry tests are serialized to avoid environment races.
- CLI list output is now always sorted; path-only output is deduplicated by default and `--sorted` now focuses on deduping combined name/path views.
- Uninstall by name now checks both user and system scopes and removes the font from whichever scope succeeds (subject to permissions).
- Fix Python wheel build by depending on the published `hatchling-pyo3-plugin` instead of the non-existent `hatchling-pyo3`; update `publish.sh` accordingly.
- macOS listing now uses Core Text font descriptors to return PostScript/family/style/format metadata with scope tagging; `FontliftFontFaceInfo` carries optional scope for Rust/Python consumers.
- macOS cleanup now prunes stale Core Text registrations and clears Adobe/Microsoft caches; CLI gains `--prune-only` and `--cache-only` toggles for targeted cleanup.
- Core API renamed to `FontliftFontSource`/`FontliftFontFaceInfo`; CLI and Python bindings now emit structured sources (path/format/face_index/scope) alongside face metadata.
- Python bindings add name-based uninstall/remove with dry-run support and expose cleanup flag controls through the Fire CLI wrappers.
